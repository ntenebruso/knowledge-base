<!DOCTYPE html>
<html
    lang="en-us"
    dir="ltr"
>
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Manpages - homectl.1 | Technical Notes</title>

    <link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/css/syntax.css">
        
        
    </head>
    <body>
        <header class="container header">
            <span class="header__title">Technical Notes</span>
<button id="menuOpenBtn" class="header__menu-open-btn"><i data-lucide="menu"></i></button>

  <nav id="siteNav">
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a href="/notes/">Notes</a>
    </li>
    <li>
      <a aria-current="true" class="ancestor" href="/man/">Manpages</a>
    </li>
    <li>
      <a href="/search/">Search</a>
    </li>
    </ul>
    <button id="menuCloseBtn" class="header__menu-close-btn"><i data-lucide="x"></i></button>
  </nav>


        </header>
        <main class="container">
            
    <h1>Manpages - homectl.1</h1>
    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
NAME
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>homectl, systemd-homed-firstboot.service - Create, remove, change or
inspect home directories</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
SYNOPSIS
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p><strong>homectl</strong> [OPTIONS…] {COMMAND} [NAME…]</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
DESCRIPTION
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p><strong>homectl</strong> may be used to create, remove, change or inspect a users home
directory. Its primarily a command interfacing with
*systemd-homed.service*(8) which manages home directories of users.</p>
<p>
Home directories managed by systemd-homed.service are self-contained,
and thus include the users full metadata record in the homes data
storage itself, making them easy to migrate between machines. In
particular, a home directory describes a matching user record, and every
user record managed by systemd-homed.service also implies existence and
encapsulation of a home directory. The user account and home directory
become the same concept.</p>
<p>
The following backing storage mechanisms are supported:</p>
<blockquote>
<p>·</p>
<p>
An individual LUKS2 encrypted loopback file for a user, stored in
/home/*.home. At login the file system contained in this files is
mounted, after the LUKS2 encrypted volume has been attached. The users
password is identical to the encryption passphrase of the LUKS2 volume.
Access to data without preceding user authentication is thus not
possible, even for the system administrator. This storage mechanism
provides the strongest data security and is thus recommended.</p>
</blockquote>
<blockquote>
<p>·</p>
<p>
Similar, but the LUKS2 encrypted file system is located on regular block
device, such as a USB storage stick. In this mode home directories and
all data they include are nicely migratable between machines, simply by
plugging the USB stick into different systems at different times.</p>
</blockquote>
<blockquote>
<p>·</p>
<p>
An encrypted directory using &#34;fscrypt&#34; on file systems that support it
(at the moment this is primarily &#34;ext4&#34;), located in /home/*.homedir.
This mechanism also provides encryption, but substantially weaker than
LUKS2, as most file system metadata is unprotected. Moreover it
currently does not support changing user passwords once the home
directory has been created.</p>
</blockquote>
<blockquote>
<p>·</p>
<p>
A &#34;btrfs&#34; subvolume for each user, also located in /home/*.homedir. This
provides no encryption, but good quota support.</p>
</blockquote>
<blockquote>
<p>·</p>
<p>
A regular directory for each user, also located in /home/*.homedir. This
provides no encryption, but is a suitable fallback available on all
machines, even where LUKS2, &#34;fscrypt&#34; or &#34;btrfs&#34; support is not
available.</p>
</blockquote>
<blockquote>
<p>·</p>
<p>
An individual Windows file share (CIFS) for each user.</p>
</blockquote>
<p>
Note that systemd-homed.service and <strong>homectl</strong> will not manage &#34;classic&#34;
UNIX user accounts as created with *useradd*(8) or similar tools. In
particular, this functionality is not suitable for managing system users
(i.e. users with a UID below 1000) but is exclusive to regular (&#34;human&#34;)
users.</p>
<p>
Note that users/home directories managed via <strong>systemd-homed.service</strong> do
not show up in /etc/passwd and similar files, they are synthesized via
glibc NSS during runtime. They are thus resolvable and may be enumerated
via the *getent*(1) tool.</p>
<p>
This tool interfaces directly with systemd-homed.service, and may
execute specific commands on the home directories it manages. Since
every home directory managed that way also defines a JSON user and group
record these home directories may also be inspected and enumerated via
*userdbctl*(1).</p>
<p>
Home directories managed by systemd-homed.service are usually in one of
two states, or in a transition state between them: when &#34;active&#34; they
are unlocked and mounted, and thus accessible to the system and its
programs; when &#34;inactive&#34; they are not mounted and thus not accessible.
Activation happens automatically at login of the user and usually can
only complete after a password (or other authentication token) has been
supplied. Deactivation happens after the user fully logged out. A home
directory remains active as long as the user is logged in at least once,
i.e. has at least one login session. When the user logs in a second time
simultaneously the home directory remains active. It is deactivated only
after the last of the users sessions ends.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
OPTIONS
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>The following general options are understood (further options that
control the various properties of user records managed by
systemd-homed.service are documented further down):</p>
<p>
*–identity=*/FILE/</p>
<blockquote>
<p>Read the users JSON record from the specified file. If passed as &#34;-&#34;
read the user record from standard input. The supplied JSON object must
follow the structure documented in <strong>JSON User Records</strong>[1]. This option
may be used in conjunction with the <strong>create</strong> and <strong>update</strong> commands (see
below), where it allows configuring the user record in JSON as-is,
instead of setting the individual user record properties (see below).</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>–json=*/FORMAT/, *-j</strong></p>
<blockquote>
<p>Controls whether to output the user record in JSON format, if the
<strong>inspect</strong> command (see below) is used. Takes one of &#34;pretty&#34;, &#34;short&#34; or
&#34;off&#34;. If &#34;pretty&#34; human-friendly whitespace and newlines are inserted
in the output to make the JSON data more readable. If &#34;short&#34; all
superfluous whitespace is suppressed. If &#34;off&#34; (the default) the user
information is not shown in JSON format but in a friendly human readable
formatting instead. The <strong>-j</strong> option picks &#34;pretty&#34; when run
interactively and &#34;short&#34; otherwise.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>–export-format=*/FORMAT/, *-E</strong>, <strong>-EE</strong></p>
<blockquote>
<p>When used with the <strong>inspect</strong> verb in JSON mode (see above) may be used
to suppress certain aspects of the JSON user record on output.
Specifically, if &#34;stripped&#34; format is used the binding and runtime
fields of the record are removed. If &#34;minimal&#34; format is used the
cryptographic signature is removed too. If &#34;full&#34; format is used the
full JSON record is shown (this is the default). This option is useful
for copying an existing user record to a different system in order to
create a similar user there with the same settings. Specifically:
<strong>homectl inspect -EE | ssh root@othersystem homectl create -i-</strong> may be
used as simple command line for replicating a user on another host. <strong>-E</strong>
is equivalent to <strong>-j –export-format=stripped</strong>, <strong>-EE</strong> to <strong>-j
–export-format=minimal</strong>. Note that when replicating user accounts user
records acquired in &#34;stripped&#34; mode will retain the original
cryptographic signatures and thus may only be modified when the private
key to update them is available on the destination machine. When
replicating users in &#34;minimal&#34; mode, the signature is removed during the
replication and thus the record will be implicitly signed with the key
of the destination machine and may be updated there without any private
key replication.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>–offline</strong></p>
<blockquote>
<p>Do not attempt to update the copy of the user record and blob directory
that is embedded inside of the home area. This allows for operation on
home areas that are absent, or without needing to authenticate as the
user being modified.</p>
<p>
Added in version 256.</p>
</blockquote>
<p>
<strong>-H</strong>, <strong>–host=</strong></p>
<blockquote>
<p>Execute the operation remotely. Specify a hostname, or a username and
hostname separated by &#34;@&#34;, to connect to. The hostname may optionally be
suffixed by a port ssh is listening on, separated by &#34;:&#34;, and then a
container name, separated by &#34;/&#34;, which connects directly to a specific
container on the specified host. This will use SSH to talk to the remote
machine manager instance. Container names may be enumerated with
*machinectl -H */HOST/. Put IPv6 addresses in brackets.</p>
</blockquote>
<p>
<strong>-M</strong>, <strong>–machine=</strong></p>
<blockquote>
<p>Execute operation on a local container. Specify a container name to
connect to, optionally prefixed by a user name to connect as and a
separating &#34;@&#34; character. If the special string &#34;.host&#34; is used in place
of the container name, a connection to the local system is made (which
is useful to connect to a specific users user bus: &#34;–user
–machine=lennart@.host&#34;). If the &#34;@&#34; syntax is not used, the connection
is made as root user. If the &#34;@&#34; syntax is used either the left hand
side or the right hand side may be omitted (but not both) in which case
the local user name and &#34;.host&#34; are implied.</p>
</blockquote>
<p>
<strong>–no-pager</strong></p>
<blockquote>
<p>Do not pipe output into a pager.</p>
</blockquote>
<p>
<strong>–no-legend</strong></p>
<blockquote>
<p>Do not print the legend, i.e. column headers and the footer with hints.</p>
</blockquote>
<p>
<strong>–no-ask-password</strong></p>
<blockquote>
<p>Do not query the user for authentication for privileged operations.</p>
</blockquote>
<p>
<strong>-h</strong>, <strong>–help</strong></p>
<blockquote>
<p>Print a short help text and exit.</p>
</blockquote>
<p>
<strong>–version</strong></p>
<blockquote>
<p>Print a short version string and exit.</p>
</blockquote>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
USER RECORD PROPERTIES
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>The following options control various properties of the user
records/home directories that systemd-homed.service manages. These
switches may be used in conjunction with the <strong>create</strong> and <strong>update</strong>
commands for configuring various aspects of the home directory and the
user account:</p>
<p>
<strong>–real-name=*/NAME/, *-c</strong> <em>NAME</em></p>
<blockquote>
<p>The real name for the user. This corresponds with the GECOS field on
classic UNIX NSS records.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–realm=*/REALM/</p>
<blockquote>
<p>The realm for the user. The realm associates a user with a specific
organization or installation, and allows distinguishing users of the
same name defined in different contexts. The realm can be any string
that also qualifies as valid DNS domain name, and it is recommended to
use the organizations or installations domain name for this purpose, but
this is not enforced nor required. On each system only a single user of
the same name may exist, and if a user with the same name and realm is
seen it is assumed to refer to the same user while a user with the same
name but different realm is considered a different user. Note that this
means that two users sharing the same name but with distinct realms are
not allowed on the same system. Assigning a realm to a user is optional.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–email-address=*/EMAIL/</p>
<blockquote>
<p>Takes an electronic mail address to associate with the user. On log-in
the <em>$EMAIL</em> environment variable is initialized from this value.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–location=*/TEXT/</p>
<blockquote>
<p>Takes location specification for this user. This is free-form text,
which might or might not be usable by geo-location applications.
Example: <strong>–location=&#34;Berlin, Germany&#34;</strong> or <strong>–location=&#34;Basement, Room
3a&#34;</strong></p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–icon-name=*/ICON/</p>
<blockquote>
<p>Takes an icon name to associate with the user, following the scheme
defined by the <strong>Icon Naming Specification</strong>[2].</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–home-dir=*/PATH/, *-d*/PATH/</p>
<blockquote>
<p>Takes a path to use as home directory for the user. Note that this is
the directory the users home directory is mounted to while the user is
logged in. This is not where the users data is actually stored, see
<strong>–image-path=</strong> for that. If not specified defaults to /home/$USER.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–uid=*/UID/</p>
<blockquote>
<p>Takes a preferred numeric UNIX UID to assign this user. If a user is to
be created with the specified UID and it is already taken by a different
user on the local system then creation of the home directory is refused.
Note though, if after creating the home directory it is used on a
different system and the configured UID is taken by another user there,
then <strong>systemd-homed</strong> may assign the user a different UID on that system.
The specified UID must be outside of the system user range. It is
recommended to use the 60001…60513 UID range for this purpose. If not
specified, the UID is automatically picked. If the home directory is
found to be owned by a different UID when logging in, the home directory
and everything underneath it will have its ownership changed
automatically before login completes.</p>
<p>
Note that changing this option for existing home directories generally
has no effect on home directories that already have been registered
locally (have a local <em>binding</em>), as the UID used for an account on the
local system is determined when the home directory is first activated on
it, and then remains in effect until the home directory is removed.</p>
<p>
Note that users managed by <strong>systemd-homed</strong> always have a matching group
associated with the same name as well as a GID matching the UID of the
user. Thus, configuring the GID separately is not permitted.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>–member-of=*/GROUP/, *-G</strong> <em>GROUP</em></p>
<blockquote>
<p>Takes a comma-separated list of auxiliary UNIX groups this user shall
belong to. Example: <strong>–member-of=wheel</strong> to provide the user with
administrator privileges. Note that <strong>systemd-homed</strong> does not manage any
groups besides a group matching the user in name and numeric UID/GID.
Thus any groups listed here must be registered independently, for
example with *groupadd*(8). Any non-existent groups are ignored. This
option may be used more than once, in which case all specified group
lists are combined. If the user is currently a member of a group which
is not listed, the user will be removed from the group.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–capability-bounding-set=*/CAPABILITIES/,
*–capability-ambient-set=*/CAPABILITIES/</p>
<blockquote>
<p>These options take a space separated list of process capabilities (e.g.
<strong>CAP_WAKE_ALARM</strong>, <strong>CAP_BLOCK_SUSPEND</strong>, …) that shall be set in the
capability bounding and ambient sets for all the users sessions. See
*capabilities*(7) for details on the capabilities concept. These options
may be used more than once, in which case the specified lists are
combined. If the parameter begins with a &#34;~&#34; character the effect is
inverted: the specified capability is dropped from the specific set.</p>
<p>
Added in version 254.</p>
</blockquote>
<p>
*–skel=*/PATH/</p>
<blockquote>
<p>Takes a file system path to a directory. Specifies the skeleton
directory to initialize the home directory with. All files and
directories in the specified path are copied into any newly create home
directory. If not specified defaults to <em>etc/skel</em>.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–shell=*/SHELL/</p>
<blockquote>
<p>Takes a file system path. Specifies the shell binary to execute on
terminal logins. If not specified defaults to /bin/bash.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>–setenv=*/VARIABLE/</strong>[=*/VALUE/*]*</p>
<blockquote>
<p>Takes an environment variable assignment to set for all user processes.
May be used multiple times to set multiple environment variables. When
&#34;=&#34; and <em>VALUE</em> are omitted, the value of the variable with the same
name in the program environment will be used.</p>
<p>
Note that a number of other settings also result in environment
variables to be set for the user, including <strong>–email=</strong>, <strong>–timezone=</strong>
and <strong>–language=</strong>.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–timezone=*/TIMEZONE/</p>
<blockquote>
<p>Takes a time zone location name that sets the timezone for the specified
user. When the user logs in the <em>$TZ</em> environment variable is
initialized from this setting. Example: <strong>–timezone=Europe/Amsterdam</strong>
will result in the environment variable &#34;TZ=:Europe/Amsterdam&#34;. (&#34;:&#34; is
used intentionally as part of the timezone specification, see
*tzset*(3).)</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–language=*/LANG/</p>
<blockquote>
<p>Takes a comma- or colon-separated list of languages preferred by the
user, ordered by descending priority. The <em>$LANG</em> and <em>$LANGUAGE</em>
environment variables are initialized from this value on login, and thus
values suitible for these environment variables are accepted here, for
example <strong>–language=de_DE.UTF-8</strong>. This option may be used more than
once, in which case the language lists are concatenated.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–ssh-authorized-keys=*/KEYS/</p>
<blockquote>
<p>Either takes a SSH authorized key line to associate with the user record
or a &#34;@&#34; character followed by a path to a file to read one or more such
lines from. SSH keys configured this way are made available to SSH to
permit access to this home directory and user record. This option may be
used more than once to configure multiple SSH keys.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–pkcs11-token-uri=*/URI/</p>
<blockquote>
<p>Takes an RFC 7512 PKCS#11 URI referencing a security token (e.g. YubiKey
or PIV smartcard) that shall be able to unlock the user account. The
security token URI should reference a security token with exactly one
pair of X.509 certificate and private key. A random secret key is then
generated, encrypted with the public key of the X.509 certificate, and
stored as part of the user record. At login time it is decrypted with
the PKCS#11 module and then used to unlock the account and associated
resources. See below for an example how to set up authentication with a
security token.</p>
<p>
Instead of a valid PKCS#11 URI, the special strings &#34;list&#34; and &#34;auto&#34;
may be specified. If &#34;list&#34; is passed, a brief table of suitable,
currently plugged in PKCS#11 hardware tokens is shown, along with their
URIs. If &#34;auto&#34; is passed, a suitable PKCS#11 hardware token is
automatically selected (this operation will fail if there isnt exactly
one suitable token discovered). The latter is a useful shortcut for the
most common case where a single PKCS#11 hardware token is plugged in.</p>
<p>
Note that many hardware security tokens implement both PKCS#11/PIV and
FIDO2 with the &#34;hmac-secret&#34; extension (for example: the YubiKey 5
series), as supported with the <strong>–fido2-device=</strong> option below. Both
mechanisms are similarly powerful, though FIDO2 is the more modern
technology. PKCS#11/PIV tokens have the benefit of being recognizable
before authentication and hence can be used for implying the user
identity to use for logging in, which FIDO2 does not allow. PKCS#11/PIV
devices generally require initialization (i.e. storing a private/public
key pair on them, see example below) before they can be used; FIDO2
security tokens generally do not required that, and work out of the box.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–fido2-credential-algorithm=*/STRING/</p>
<blockquote>
<p>Specify COSE algorithm used in credential generation. The default value
is &#34;es256&#34;. Supported values are &#34;es256&#34;, &#34;rs256&#34; and &#34;eddsa&#34;.</p>
<p>
&#34;es256&#34; denotes ECDSA over NIST P-256 with SHA-256. &#34;rs256&#34; denotes
2048-bit RSA with PKCS#1.5 padding and SHA-256. &#34;eddsa&#34; denotes EDDSA
over Curve25519 with SHA-512.</p>
<p>
Note that your authenticator may choose not to support some algorithms.</p>
<p>
Added in version 251.</p>
</blockquote>
<p>
*–fido2-device=*/PATH/</p>
<blockquote>
<p>Takes a path to a Linux &#34;hidraw&#34; device (e.g. /dev/hidraw1), referring
to a FIDO2 security token implementing the &#34;hmac-secret&#34; extension that
shall be able to unlock the user account. A random salt value is
generated on the host and passed to the FIDO2 device, which calculates a
HMAC hash of the salt using an internal secret key. The result is then
used as the key to unlock the user account. The random salt is included
in the user record, so that whenever authentication is needed it can be
passed to the FIDO2 token again.</p>
<p>
Instead of a valid path to a FIDO2 &#34;hidraw&#34; device the special strings
&#34;list&#34; and &#34;auto&#34; may be specified. If &#34;list&#34; is passed, a brief table
of suitable discovered FIDO2 devices is shown. If &#34;auto&#34; is passed, a
suitable FIDO2 token is automatically selected, if exactly one is
discovered. The latter is a useful shortcut for the most common case
where a single FIDO2 hardware token is plugged in.</p>
<p>
Note that FIDO2 devices suitable for this option must implement the
&#34;hmac-secret&#34; extension. Most current devices (such as the YubiKey 5
series) do. If the extension is not implemented the device cannot be
used for unlocking home directories.</p>
<p>
The FIDO2 device may be subsequently removed by setting the device path
to an empty string (e.g. <strong>homectl update $USER –fido2-device=&#34;&#34;</strong>).</p>
<p>
Note that many hardware security tokens implement both FIDO2 and
PKCS#11/PIV (and thus may be used with either <strong>–fido2-device=</strong> or
<strong>–pkcs11-token-uri=</strong>), for a discussion see above.</p>
<p>
Added in version 246.</p>
</blockquote>
<p>
*–fido2-with-client-pin=*/BOOL/</p>
<blockquote>
<p>When enrolling a FIDO2 security token, controls whether to require the
user to enter a PIN when unlocking the account (the FIDO2 &#34;clientPin&#34;
feature). Defaults to &#34;yes&#34;. (Note: this setting is without effect if
the security token does not support the &#34;clientPin&#34; feature at all, or
does not allow enabling or disabling it.)</p>
<p>
Added in version 249.</p>
</blockquote>
<p>
*–fido2-with-user-presence=*/BOOL/</p>
<blockquote>
<p>When enrolling a FIDO2 security token, controls whether to require the
user to verify presence (tap the token, the FIDO2 &#34;up&#34; feature) when
unlocking the account. Defaults to &#34;yes&#34;. (Note: this setting is without
effect if the security token does not support the &#34;up&#34; feature at all,
or does not allow enabling or disabling it.)</p>
<p>
Added in version 249.</p>
</blockquote>
<p>
*–fido2-with-user-verification=*/BOOL/</p>
<blockquote>
<p>When enrolling a FIDO2 security token, controls whether to require user
verification when unlocking the account (the FIDO2 &#34;uv&#34; feature).
Defaults to &#34;no&#34;. (Note: this setting is without effect if the security
token does not support the &#34;uv&#34; feature at all, or does not allow
enabling or disabling it.)</p>
<p>
Added in version 249.</p>
</blockquote>
<p>
*–recovery-key=*/BOOL/</p>
<blockquote>
<p>Accepts a boolean argument. If enabled a recovery key is configured for
the account. A recovery key is a computer generated access key that may
be used to regain access to an account if the password has been
forgotten or the authentication token lost. The key is generated and
shown on screen, and should be printed or otherwise transferred to a
secure location. A recovery key may be entered instead of a regular
password to unlock the account.</p>
<p>
Added in version 247.</p>
</blockquote>
<p>
<strong>–blob=*/PATH/, *-b</strong> <em>PATH</em>, <strong>–blob=*/FILENAME/*=*/PATH/, *-b</strong>
<em>FILENAME/=/PATH</em></p>
<blockquote>
<p>Accepts either a directory path, or a file name followed by a file path.
If just a directory path is specified, then the users entire blob
directory is replaced the specified path. Note that this replacement is
performed before per-file manipulations are applied, which means these
per-file manipulations will be applied on top of the specified
directory. If a filename and file path are specified, then the single
specified blob file will be overwritten with the specified path. If
completely blank, the entire blob directory is emptied out (which also
resets all previous blob-related flags up to this point). If a filename
is specified but the corresponding path is blank, that single file will
be deleted from the blob directory. All changes are performed in
temporary copies of the specified files in directories, which means that
the originals specified on the command line are not modified. See <strong>User
Record Blob Directories</strong>[3] for more information about blob directories.</p>
<p>
Added in version 256.</p>
</blockquote>
<p>
*–avatar=*/PATH/, *–login-background=*/PATH/</p>
<blockquote>
<p>Accept a file path. If set, the specified file is used to overwrite the
corresponding file in the users blob directory. If blank, the
corresponding file is deleted from the blob directory. Essentially,
these options are shortcuts to <strong>–blob=*/FILENAME/*=*/PATH/ for the
known filenames defined in *User Record Blob Directories</strong>[3].</p>
<p>
Added in version 256.</p>
</blockquote>
<p>
*–locked=*/BOOLEAN/</p>
<blockquote>
<p>Takes a boolean argument. Specifies whether this user account shall be
locked. If true logins into this account are prohibited, if false (the
default) they are permitted (of course, only if authorization otherwise
succeeds).</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–not-before=*/TIMESTAMP/, *–not-after=*/TIMESTAMP/</p>
<blockquote>
<p>These options take a timestamp string, in the format documented in
*systemd.time*(7) and configures points in time before and after logins
into this account are not permitted.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–rate-limit-interval=*/SECS/, *–rate-limit-burst=*/NUMBER/</p>
<blockquote>
<p>Configures a rate limit on authentication attempts for this user. If the
user attempts to authenticate more often than the specified number, on a
specific system, within the specified time interval authentication is
refused until the time interval passes. Defaults to 10 times per 1min.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–password-hint=*/TEXT/</p>
<blockquote>
<p>Takes a password hint to store alongside the user record. This string is
stored accessible only to privileged users and the user itself and may
not be queried by other users. Example: <strong>–password-hint=&#34;My first pets
name&#34;</strong>.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>–enforce-password-policy=*/BOOL/, *-P</strong></p>
<blockquote>
<p>Takes a boolean argument. Configures whether to enforce the systems
password policy for this user, regarding quality and strength of
selected passwords. Defaults to on. <strong>-P</strong> is short for
<strong>—enforce-password-policy=no</strong>.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–password-change-now=*/BOOL/</p>
<blockquote>
<p>Takes a boolean argument. If true the user is asked to change their
password on next login.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–password-change-min=*/TIME/, *–password-change-max=*/TIME/,
*–password-change-warn=*/TIME/, *–password-change-inactive=*/TIME/</p>
<blockquote>
<p>Each of these options takes a time span specification as argument (in
the syntax documented in *systemd.time*(7)) and configures various
aspects of the users password expiration policy. Specifically,
<strong>–password-change-min=</strong> configures how much time has to pass after
changing the password of the user until the password may be changed
again. If the user tries to change their password before this time
passes the attempt is refused. <strong>–password-change-max=</strong> configures how
soon after it has been changed the password expires and needs to be
changed again. After this time passes logging in may only proceed after
the password is changed. <strong>–password-change-warn=</strong> specifies how much
earlier than then the time configured with <strong>–password-change-max=</strong> the
user is warned at login to change their password as it will expire soon.
Finally <strong>–password-change-inactive=</strong> configures the time which has to
pass after the password as expired until the user is not permitted to
log in or change the password anymore. Note that these options only
apply to password authentication, and do not apply to other forms of
authentication, for example PKCS#11-based security token authentication.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–disk-size=*/BYTES/</p>
<blockquote>
<p>Either takes a size in bytes as argument (possibly using the usual K, M,
G, … suffixes for 1024 base values), a percentage value, or the
special strings &#34;min&#34; or &#34;max&#34;, and configures the disk space to assign
to the user. If a percentage value is specified (i.e. the argument
suffixed with &#34;%&#34;) it is taken relative to the available disk space of
the backing file system. If specified as &#34;min&#34; assigns the minimal disk
space permitted by the constraints of the backing file system and other
limits, when specified as &#34;max&#34; assigns the maximum disk space
available. If the LUKS2 backend is used this configures the size of the
loopback file and file system contained therein. For the other storage
backends configures disk quota using the filesystems native quota logic,
if available. If not specified, defaults to 85% of the available disk
space for the LUKS2 backend and to no quota for the others.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–access-mode=*/MODE/</p>
<blockquote>
<p>Takes a UNIX file access mode written in octal. Configures the access
mode of the home directory itself. Note that this is only used when the
directory is first created, and the user may change this any time
afterwards. Example: <strong>–access-mode=0700</strong></p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–umask=*/MASK/</p>
<blockquote>
<p>Takes the access mode mask (in octal syntax) to apply to newly created
files and directories of the user (&#34;umask&#34;). If set this controls the
initial umask set for all login sessions of the user, possibly
overriding the systems defaults.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–nice=*/NICE/</p>
<blockquote>
<p>Takes the numeric scheduling priority (&#34;nice level&#34;) to apply to the
processes of the user at login time. Takes a numeric value in the range
-20 (highest priority) to 19 (lowest priority).</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>–rlimit=*/LIMIT/*=*/VALUE/</strong>[:*/VALUE/]</p>
<blockquote>
<p>Allows configuration of resource limits for processes of this user, see
*getrlimit*(2) for details. Takes a resource limit name (e.g.
&#34;LIMIT_NOFILE&#34;) followed by an equal sign, followed by a numeric limit.
Optionally, separated by colon a second numeric limit may be specified.
If two are specified this refers to the soft and hard limits,
respectively. If only one limit is specified the setting sets both
limits in one.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–tasks-max=*/TASKS/</p>
<blockquote>
<p>Takes a non-zero unsigned integer as argument. Configures the maximum
number of tasks (i.e. threads, where each process is at least one
thread) the user may have at any given time. This limit applies to all
tasks forked off the users sessions, even if they change user identity
via <strong>su*(1) or a similar tool. Use *–rlimit=LIMIT_NPROC=</strong> to place a
limit on the tasks actually running under the UID of the user, thus
excluding any child processes that might have changed user identity.
This controls the <em>TasksMax=</em> setting of the per-user systemd slice unit
user-$UID.slice. See *systemd.resource-control*(5) for further details.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–memory-high=*/BYTES/, *–memory-max=*/BYTES/</p>
<blockquote>
<p>Set a limit on the memory a user may take up on a system at any given
time in bytes (the usual K, M, G, … suffixes are supported, to the
base of 1024). This includes all memory used by the user itself and all
processes they forked off that changed user credentials. This controls
the <em>MemoryHigh=</em> and <em>MemoryMax=</em> settings of the per-user systemd
slice unit user-$UID.slice. See *systemd.resource-control*(5) for
further details.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–cpu-weight=*/WEIGHT/, *–io-weight=*/WEIGHT/</p>
<blockquote>
<p>Set CPU and IO scheduling weights of the processes of the user,
including those of processes forked off by the user that changed user
credentials. Takes a numeric value in the range 1…10000. This controls
the <em>CPUWeight=</em> and <em>IOWeight=</em> settings of the per-user systemd slice
unit user-$UID.slice. See *systemd.resource-control*(5) for further
details.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–storage=*/STORAGE/</p>
<blockquote>
<p>Selects the storage mechanism to use for this home directory. Takes one
of &#34;luks&#34;, &#34;fscrypt&#34;, &#34;directory&#34;, &#34;subvolume&#34;, &#34;cifs&#34;. For details
about these mechanisms, see above. If a new home directory is created
and the storage type is not specifically specified, *homed.conf*(5)
defines which default storage to use.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–image-path=*/PATH/</p>
<blockquote>
<p>Takes a file system path. Configures where to place the users home
directory. When LUKS2 storage is used refers to the path to the loopback
file, otherwise to the path to the home directory (which may be in
<em>home</em> or any other accessible filesystem). When unspecified defaults to
/home/$USER.home when LUKS storage is used and /home/$USER.homedir for
the other storage mechanisms. Not defined for the &#34;cifs&#34; storage
mechanism. To use LUKS2 storage on a regular block device (for example a
USB stick) pass the path to the block device here. Specifying the path
to a directory here when using LUKS2 storage is not allowed. Similar,
specifying the path to a regular file or device node is not allowed if
any of the other storage backends are used.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–drop-caches=*/BOOL/</p>
<blockquote>
<p>Automatically flush OS file system caches on logout. This is useful in
combination with the fscrypt storage backend to ensure the OS does not
keep decrypted versions of the files and directories in memory (and
accessible) after logout. This option is also supported on other
backends, but should not bring any benefit there. Defaults to off,
except if the selected storage backend is fscrypt, where it defaults to
on. Note that flushing OS caches will negatively influence performance
of the OS shortly after logout.</p>
<p>
Added in version 250.</p>
</blockquote>
<p>
*–fs-type=*/TYPE/</p>
<blockquote>
<p>When LUKS2 storage is used configures the file system type to use inside
the home directory LUKS2 container. One of &#34;btrfs&#34;, &#34;ext4&#34;, &#34;xfs&#34;. If
not specified *homed.conf*(5) defines which default file system type to
use. Note that &#34;xfs&#34; is not recommended as its support for file system
resizing is too limited.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–luks-discard=*/BOOL/</p>
<blockquote>
<p>When LUKS2 storage is used configures whether to enable the &#34;discard&#34;
feature of the file system. If enabled the file system on top of the
LUKS2 volume will report empty block information to LUKS2 and the
loopback file below, ensuring that empty space in the home directory is
returned to the backing file system below the LUKS2 volume, resulting in
a &#34;sparse&#34; loopback file. This option mostly defaults to off, since this
permits over-committing home directories which results in I/O errors if
the underlying file system runs full while the upper file system wants
to allocate a block. Such I/O errors are generally not handled well by
file systems nor applications. When LUKS2 storage is used on top of
regular block devices (instead of on top a loopback file) the discard
logic defaults to on.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–luks-offline-discard=*/BOOL/</p>
<blockquote>
<p>Similar to <strong>–luks-discard=</strong>, controls the trimming of the file system.
However, while <strong>–luks-discard=</strong> controls what happens when the home
directory is active, <strong>–luks-offline-discard=</strong> controls what happens
when it becomes inactive, i.e. whether to trim/allocate the storage when
deactivating the home directory. This option defaults to on, to ensure
disk space is minimized while a user is not logged in.</p>
<p>
Added in version 246.</p>
</blockquote>
<p>
*–luks-extra-mount-options=*/OPTIONS/</p>
<blockquote>
<p>Takes a string containing additional mount options to use when mounting
the LUKS volume. If specified, this string will be appended to the
default, built-in mount options.</p>
<p>
Added in version 250.</p>
</blockquote>
<p>
*–luks-cipher=*/CIPHER/, *–luks-cipher-mode=*/MODE/,
*–luks-volume-key-size=*/BYTES/, *–luks-pbkdf-type=*/TYPE/,
*–luks-pbkdf-hash-algorithm=*/ALGORITHM/,
*–luks-pbkdf-force-iterations=*/ITERATIONS/,
*–luks-pbkdf-time-cost=*/SECONDS/, *–luks-pbkdf-memory-cost=*/BYTES/,
*–luks-pbkdf-parallel-threads=*/THREADS/, *–luks-sector-size=*/BYTES/</p>
<blockquote>
<p>Configures various cryptographic parameters for the LUKS2 storage
mechanism. See *cryptsetup*(8) for details on the specific attributes.</p>
<p>
Note that <strong>homectl</strong> uses bytes for key size, like /proc/crypto, but
*cryptsetup*(8) uses bits.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>–auto-resize-mode=</strong></p>
<blockquote>
<p>Configures whether to automatically grow and/or shrink the backing file
system on login and logout. Takes one of the strings &#34;off&#34;, &#34;grow&#34;,
&#34;shrink-and-grow&#34;. Only applies to the LUKS2 backend currently, and if
the btrfs file system is used inside it (since only then online
growing/shrinking of the file system is supported). Defaults to
&#34;shrink-and-grow&#34;, if LUKS2/btrfs is used, otherwise is off. If set to
&#34;off&#34; no automatic shrinking/growing during login or logout is done. If
set to &#34;grow&#34; the home area is grown to the size configured via
<strong>–disk-size=</strong> should it currently be smaller. If it already matches the
configured size or is larger no operation is executed. If set to
&#34;shrink-and-grow&#34; the home area is also resized during logout to the
minimal size the used disk space and file system constraints permit.
This mode thus ensures that while a home area is activated it is sized
to the configured size, but while deactivated it is compacted taking up
only the minimal space possible. Note that if the system is powered off
abnormally or if the user otherwise not logged out cleanly the shrinking
operation will not take place, and the user has to re-login/logout again
before it is executed again.</p>
<p>
Added in version 250.</p>
</blockquote>
<p>
<strong>–rebalance-weight=</strong></p>
<blockquote>
<p>Configures the weight parameter for the free disk space rebalancing
logic. Only applies to the LUKS2 backend (since for the LUKS2 backend
disk space is allocated from a per-user loopback file system instead of
immediately from a common pool like the other backends do it). In
regular intervals free disk space in the active home areas and their
backing storage is redistributed among them, taking the weight value
configured here into account. Expects an integer in the range 1…10000,
or the special string &#34;off&#34;. If not specified defaults to 100. The
weight is used to scale free space made available to the home areas: a
home area with a weight of 200 will get twice the free space as one with
a weight of 100; a home area with a weight of 50 will get half of that.
The backing file system will be assigned space for a weight of 20. If
set to &#34;off&#34; no automatic free space distribution is done for this home
area. Note that resizing the home area explicitly (with <strong>homectl resize</strong>
see below) will implicitly turn off the automatic rebalancing. To
reenable the automatic rebalancing use <strong>–rebalance-weight=</strong> with an
empty parameter.</p>
<p>
Added in version 250.</p>
</blockquote>
<p>
*–nosuid=*/BOOL/, *–nodev=*/BOOL/, *–noexec=*/BOOL/</p>
<blockquote>
<p>Configures the &#34;nosuid&#34;, &#34;nodev&#34; and &#34;noexec&#34; mount options for the home
directories. By default &#34;nodev&#34; and &#34;nosuid&#34; are on, while &#34;noexec&#34; is
off. For details about these mount options see *mount*(8).</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–cifs-domain=*/DOMAIN/, *–cifs-user-name=*/USER/,
*–cifs-service=*/SERVICE/, *–cifs-extra-mount-options=*/OPTIONS/</p>
<blockquote>
<p>Configures the Windows File Sharing (CIFS) domain and user to associate
with the home directory/user account, as well as the file share
(&#34;service&#34;) to mount as directory. The latter is used when &#34;cifs&#34;
storage is selected. The file share should be specified in format
&#34;<em>//host///share///directory</em>…/&#34;. The directory part is optional —
if not specified the home directory will be placed in the top-level
directory of the share. The <strong>–cifs-extra-mount-options=</strong> setting allows
specifying additional mount options when mounting the share, see
*mount.cifs*(8) for details.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–stop-delay=*/SECS/</p>
<blockquote>
<p>Configures the time the per-user service manager shall continue to run
after the all sessions of the user ended. The default is configured in
*logind.conf*(5) (for home directories of LUKS2 storage located on
removable media this defaults to 0 though). A longer time makes sure
quick, repetitive logins are more efficient as the users service manager
doesnt have to be started every time.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–kill-processes=*/BOOL/</p>
<blockquote>
<p>Configures whether to kill all processes of the user on logout. The
default is configured in *logind.conf*(5).</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–auto-login=*/BOOL/</p>
<blockquote>
<p>Takes a boolean argument. Configures whether the graphical UI of the
system should automatically log this user in if possible. Defaults to
off. If less or more than one user is marked this way automatic login is
disabled.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
*–session-launcher=*/LAUNCHER/</p>
<blockquote>
<p>Takes a string argument. Configures the users preferred session launcher
.desktop entry file (i.e. &#34;gnome&#34;, &#34;plasma&#34;, or other names that appear
in <em>usr/share/xesssions</em> or /usr/share/wayland-sessions). This is read
by the display manager to pick the default session that is launched when
the user logs in.</p>
<p>
Added in version 256.</p>
</blockquote>
<p>
*–session-type=*/TYPE/</p>
<blockquote>
<p>Takes a string argument. Configures the users preferred session type
(i.e. &#34;x11&#34;, &#34;wayland&#34;, and other values accepted by
<em>$XDG_SESSION_TYPE</em>). This is read by the display manage to pick the
default session type the user is logged into.</p>
<p>
Added in version 256.</p>
</blockquote>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
COMMANDS
</h2>
<div id="outline-text-headline-6" class="outline-text-2">
<p>The following commands are understood:</p>
<p>
<strong>list</strong></p>
<blockquote>
<p>List all home directories (along with brief details) currently managed
by systemd-homed.service. This command is also executed if none is
specified on the command line. (Note that the list of users shown by
this command does not include users managed by other subsystems, such as
system users or any traditional users listed in /etc/passwd.)</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>activate</strong> <em>USER</em> [/USER…/]</p>
<blockquote>
<p>Activate one or more home directories. The home directories of each
listed user will be activated and made available under their mount
points (typically in /home/$USER). Note that any home activated this way
stays active indefinitely, until it is explicitly deactivated again
(with <strong>deactivate</strong>, see below), or the user logs in and out again and it
thus is deactivated due to the automatic deactivation-on-logout logic.</p>
<p>
Activation of a home directory involves various operations that depend
on the selected storage mechanism. If the LUKS2 mechanism is used, this
generally involves: inquiring the user for a password, setting up a
loopback device, validating and activating the LUKS2 volume, checking
the file system, mounting the file system, and potentially changing the
ownership of all included files to the correct UID/GID.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>deactivate</strong> <em>USER</em> [/USER…/]</p>
<blockquote>
<p>Deactivate one or more home directories. This undoes the effect of
<strong>activate</strong>.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>inspect</strong> <em>USER</em> [/USER…/]</p>
<blockquote>
<p>Show various details about the specified home directories. This shows
various information about the home directory and its user account,
including runtime data such as current state, disk use and similar.
Combine with <strong>–json=</strong> to show the detailed JSON user record instead,
possibly combined with <strong>–export-format=</strong> to suppress certain aspects of
the output.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>authenticate</strong> <em>USER</em> [/USER…/]</p>
<blockquote>
<p>Validate authentication credentials of a home directory. This queries
the caller for a password (or similar) and checks that it correctly
unlocks the home directory. This leaves the home directory in the state
it is in, i.e. it leaves the home directory in inactive state if it was
inactive before, and in active state if it was active before.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>create</strong> <em>USER</em>, <strong>create</strong> *–identity=*/PATH/ [/USER/]</p>
<blockquote>
<p>Create a new home directory/user account of the specified name. Use the
various user record property options (as documented above) to control
various aspects of the home directory and its user accounts.</p>
<p>
The specified user name should follow the strict syntax described on
<strong>User/Group Name Syntax</strong>[4].</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>remove</strong> <em>USER</em></p>
<blockquote>
<p>Remove a home directory/user account. This will remove both the home
directorys user record and the home directory itself, and thus delete
all files and directories owned by the user.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>update</strong> <em>USER</em>, <strong>update</strong> *–identity=*/PATH/ [/USER/]</p>
<blockquote>
<p>Update a home directory/user account. Use the various user record
property options (as documented above) to make changes to the account,
or alternatively provide a full, updated JSON user record via the
<strong>–identity=</strong> option.</p>
<p>
Note that changes to user records not signed by a cryptographic private
key available locally are not permitted, unless <strong>–identity=</strong> is used
with a user record that is already correctly signed by a recognized
private key.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>passwd</strong> <em>USER</em></p>
<blockquote>
<p>Change the password of the specified home directory/user account.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>resize</strong> <em>USER</em> <em>BYTES</em></p>
<blockquote>
<p>Change the disk space assigned to the specified home directory. If the
LUKS2 storage mechanism is used this will automatically resize the
loopback file and the file system contained within. Note that if &#34;ext4&#34;
is used inside of the LUKS2 volume, it is necessary to deactivate the
home directory before shrinking it (i.e the user has to log out).
Growing can be done while the home directory is active. If &#34;xfs&#34; is used
inside of the LUKS2 volume the home directory may not be shrunk
whatsoever. On all three of &#34;ext4&#34;, &#34;xfs&#34; and &#34;btrfs&#34; the home directory
may be grown while the user is logged in, and on the latter also shrunk
while the user is logged in. If the &#34;subvolume&#34;, &#34;directory&#34;, &#34;fscrypt&#34;
storage mechanisms are used, resizing will change file system quota. The
size parameter may make use of the usual suffixes B, K, M, G, T (to the
base of 1024). The special strings &#34;min&#34; and &#34;max&#34; may be specified in
place of a numeric size value, for minimizing or maximizing disk space
assigned to the home area, taking constraints of the file system, disk
usage inside the home area and on the backing storage into account.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>lock</strong> <em>USER</em></p>
<blockquote>
<p>Temporarily suspend access to the users home directory and remove any
associated cryptographic keys from memory. Any attempts to access the
users home directory will stall until the home directory is unlocked
again (i.e. re-authenticated). This functionality is primarily intended
to be used during system suspend to make sure the users data cannot be
accessed until the user re-authenticates on resume. This operation is
only defined for home directories that use the LUKS2 storage mechanism.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>unlock</strong> <em>USER</em></p>
<blockquote>
<p>Resume access to the users home directory again, undoing the effect of
<strong>lock</strong> above. This requires authentication of the user, as the
cryptographic keys required for access to the home directory need to be
reacquired.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>lock-all</strong></p>
<blockquote>
<p>Execute the <strong>lock</strong> command on all suitable home directories at once.
This operation is generally executed on system suspend (i.e. by
<strong>systemctl suspend</strong> and related commands), to ensure all active users
cryptographic keys for accessing their home directories are removed from
memory.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>deactivate-all</strong></p>
<blockquote>
<p>Execute the <strong>deactivate</strong> command on all active home directories at once.
This operation is generally executed on system shut down (i.e. by
<strong>systemctl poweroff</strong> and related commands), to ensure all active users
home directories are fully deactivated before <em>home</em> and related file
systems are unmounted.</p>
<p>
Added in version 247.</p>
</blockquote>
<p>
<strong>with</strong> <em>USER</em> <em>COMMAND…</em></p>
<blockquote>
<p>Activate the specified users home directory, run the specified command
(under the callers identity, not the specified users) and deactivate the
home directory afterwards again (unless the user is logged in
otherwise). This command is useful for running privileged backup scripts
and such, but requires authentication with the users credentials in
order to be able to unlock the users home directory.</p>
<p>
Added in version 245.</p>
</blockquote>
<p>
<strong>rebalance</strong></p>
<blockquote>
<p>Rebalance free disk space between active home areas and the backing
storage. See <strong>–rebalance-weight=</strong> above. This executes no operation
unless theres at least one active LUKS2 home area that has disk space
rebalancing enabled. This operation is synchronous: it will only
complete once disk space is rebalanced according to the rebalancing
weights. Note that rebalancing also takes place automatically in the
background in regular intervals. Use this command to synchronously
ensure disk space is properly redistributed before initiating an
operation requiring large amounts of disk space.</p>
<p>
Added in version 250.</p>
</blockquote>
<p>
<strong>firstboot</strong></p>
<blockquote>
<p>This command is supposed to be invoked during the initial boot of the
system. It checks whether any regular home area exists so far, and if
not queries the user interactively on the console for user name and
password and creates one. Alternatively, if one or more service
credentials whose name starts with &#34;home.create.&#34; are passed to the
command (containing a user record in JSON format) these users are
automatically created at boot.</p>
<p>
This command is invoked by the systemd-homed-firstboot.service service
unit.</p>
<p>
Added in version 256.</p>
</blockquote>
</div>
</div>
<div id="outline-container-headline-7" class="outline-2">
<h2 id="headline-7">
CREDENTIALS
</h2>
<div id="outline-text-headline-7" class="outline-text-2">
<p>When invoked with the <strong>firstboot</strong> command, <strong>homectl</strong> supports the
service credentials logic as implemented by
<em>ImportCredential=///LoadCredential=///SetCredential=</em> (see
*systemd.exec*(5) for details). The following credentials are used when
passed in:</p>
<p>
<em>home.create.*</em></p>
<blockquote>
<p>If one or more credentials whose names begin with &#34;home.create.&#34;,
followed by a valid UNIX username are passed, a new home area is
created, one for each specified user record.</p>
<p>
Added in version 256.</p>
</blockquote>
</div>
</div>
<div id="outline-container-headline-8" class="outline-2">
<h2 id="headline-8">
KERNEL COMMAND LINE
</h2>
<div id="outline-text-headline-8" class="outline-text-2">
<p><em>systemd.firstboot=</em></p>
<blockquote>
<p>This boolean will disable the effect of <strong>homectl firstboot</strong> command. Its
primarily interpreted by *systemd-firstboot*(1).</p>
<p>
Added in version 256.</p>
</blockquote>
</div>
</div>
<div id="outline-container-headline-9" class="outline-2">
<h2 id="headline-9">
EXIT STATUS
</h2>
<div id="outline-text-headline-9" class="outline-text-2">
<p>On success, 0 is returned, a non-zero failure code otherwise.</p>
<p>
When a command is invoked with <strong>with</strong>, the exit status of the child is
propagated. Effectively, <strong>homectl</strong> will exit without error if the
command is successfully invoked <em>and</em> finishes successfully.</p>
</div>
</div>
<div id="outline-container-headline-10" class="outline-2">
<h2 id="headline-10">
ENVIRONMENT
</h2>
<div id="outline-text-headline-10" class="outline-text-2">
<p><em>$SYSTEMD_LOG_LEVEL</em></p>
<blockquote>
<p>The maximum log level of emitted messages (messages with a higher log
level, i.e. less important ones, will be suppressed). Takes a
comma-separated list of values. A value may be either one of (in order
of decreasing importance) <strong>emerg</strong>, <strong>alert</strong>, <strong>crit</strong>, <strong>err</strong>, <strong>warning</strong>,
<strong>notice</strong>, <strong>info</strong>, <strong>debug</strong>, or an integer in the range 0…7. See
<strong>syslog*(3) for more information. Each value may optionally be prefixed
with one of *console</strong>, <strong>syslog</strong>, <strong>kmsg</strong> or <strong>journal</strong> followed by a colon
to set the maximum log level for that specific log target (e.g.
<strong>SYSTEMD_LOG_LEVEL=debug,console:info</strong> specifies to log at debug level
except when logging to the console which should be at info level). Note
that the global maximum log level takes priority over any per target
maximum log levels.</p>
</blockquote>
<p>
<em>$SYSTEMD_LOG_COLOR</em></p>
<blockquote>
<p>A boolean. If true, messages written to the tty will be colored
according to priority.</p>
<p>
This setting is only useful when messages are written directly to the
terminal, because *journalctl*(1) and other tools that display logs will
color messages based on the log level on their own.</p>
</blockquote>
<p>
<em>$SYSTEMD_LOG_TIME</em></p>
<blockquote>
<p>A boolean. If true, console log messages will be prefixed with a
timestamp.</p>
<p>
This setting is only useful when messages are written directly to the
terminal or a file, because *journalctl*(1) and other tools that display
logs will attach timestamps based on the entry metadata on their own.</p>
</blockquote>
<p>
<em>$SYSTEMD_LOG_LOCATION</em></p>
<blockquote>
<p>A boolean. If true, messages will be prefixed with a filename and line
number in the source code where the message originates.</p>
<p>
Note that the log location is often attached as metadata to journal
entries anyway. Including it directly in the message text can
nevertheless be convenient when debugging programs.</p>
</blockquote>
<p>
<em>$SYSTEMD_LOG_TID</em></p>
<blockquote>
<p>A boolean. If true, messages will be prefixed with the current numerical
thread ID (TID).</p>
<p>
Note that the this information is attached as metadata to journal
entries anyway. Including it directly in the message text can
nevertheless be convenient when debugging programs.</p>
</blockquote>
<p>
<em>$SYSTEMD_LOG_TARGET</em></p>
<blockquote>
<p>The destination for log messages. One of <strong>console</strong> (log to the attached
tty), <strong>console-prefixed</strong> (log to the attached tty but with prefixes
encoding the log level and &#34;facility&#34;, see <strong>syslog*(3), *kmsg</strong> (log to
the kernel circular log buffer), <strong>journal</strong> (log to the journal),
<strong>journal-or-kmsg</strong> (log to the journal if available, and to kmsg
otherwise), <strong>auto</strong> (determine the appropriate log target automatically,
the default), <strong>null</strong> (disable log output).</p>
</blockquote>
<p>
<em>$SYSTEMD_LOG_RATELIMIT_KMSG</em></p>
<blockquote>
<p>Whether to ratelimit kmsg or not. Takes a boolean. Defaults to &#34;true&#34;.
If disabled, systemd will not ratelimit messages written to kmsg.</p>
</blockquote>
<p>
<em>$SYSTEMD_PAGER</em></p>
<blockquote>
<p>Pager to use when <strong>–no-pager</strong> is not given; overrides <em>$PAGER</em>. If
neither <em>$SYSTEMD_PAGER</em> nor <em>$PAGER</em> are set, a set of well-known pager
implementations are tried in turn, including *less*(1) and *more*(1),
until one is found. If no pager implementation is discovered no pager is
invoked. Setting this environment variable to an empty string or the
value &#34;cat&#34; is equivalent to passing <strong>–no-pager</strong>.</p>
<p>
Note: if <em>$SYSTEMD_PAGERSECURE</em> is not set, <em>$SYSTEMD_PAGER</em> (as well as
<em>$PAGER</em>) will be silently ignored.</p>
</blockquote>
<p>
<em>$SYSTEMD_LESS</em></p>
<blockquote>
<p>Override the options passed to <strong>less</strong> (by default &#34;FRSXMK&#34;).</p>
<p>
Users might want to change two options in particular:</p>
<p>
<strong>K</strong></p>
<blockquote>
<p>This option instructs the pager to exit immediately when Ctrl+C is
pressed. To allow <strong>less</strong> to handle Ctrl+C itself to switch back to the
pager command prompt, unset this option.</p>
<p>
If the value of <em>$SYSTEMD_LESS</em> does not include &#34;K&#34;, and the pager that
is invoked is <strong>less</strong>, Ctrl+C will be ignored by the executable, and
needs to be handled by the pager.</p>
</blockquote>
<p>
<strong>X</strong></p>
<blockquote>
<p>This option instructs the pager to not send termcap initialization and
deinitialization strings to the terminal. It is set by default to allow
command output to remain visible in the terminal even after the pager
exits. Nevertheless, this prevents some pager functionality from
working, in particular paged output cannot be scrolled with the mouse.</p>
</blockquote>
<p>
Note that setting the regular <em>$LESS</em> environment variable has no effect
for <strong>less</strong> invocations by systemd tools.</p>
<p>
See *less*(1) for more discussion.</p>
</blockquote>
<p>
<em>$SYSTEMD_LESSCHARSET</em></p>
<blockquote>
<p>Override the charset passed to <strong>less</strong> (by default &#34;utf-8&#34;, if the
invoking terminal is determined to be UTF-8 compatible).</p>
<p>
Note that setting the regular <em>$LESSCHARSET</em> environment variable has no
effect for <strong>less</strong> invocations by systemd tools.</p>
</blockquote>
<p>
<em>$SYSTEMD_PAGERSECURE</em></p>
<blockquote>
<p>Takes a boolean argument. When true, the &#34;secure&#34; mode of the pager is
enabled; if false, disabled. If <em>$SYSTEMD_PAGERSECURE</em> is not set at
all, secure mode is enabled if the effective UID is not the same as the
owner of the login session, see <strong>geteuid*(2) and
*sd_pid_get_owner_uid*(3). In secure mode, *LESSSECURE=1</strong> will be set
when invoking the pager, and the pager shall disable commands that open
or create new files or start new subprocesses. When
<em>$SYSTEMD_PAGERSECURE</em> is not set at all, pagers which are not known to
implement secure mode will not be used. (Currently only *less*(1)
implements secure mode.)</p>
<p>
Note: when commands are invoked with elevated privileges, for example
under *sudo*(8) or *pkexec*(1), care must be taken to ensure that
unintended interactive features are not enabled. &#34;Secure&#34; mode for the
pager may be enabled automatically as describe above. Setting
<em>SYSTEMD_PAGERSECURE=0</em> or not removing it from the inherited
environment allows the user to invoke arbitrary commands. Note that if
the <em>$SYSTEMD_PAGER</em> or <em>$PAGER</em> variables are to be honoured,
<em>$SYSTEMD_PAGERSECURE</em> must be set too. It might be reasonable to
completely disable the pager using <strong>–no-pager</strong> instead.</p>
</blockquote>
<p>
<em>$SYSTEMD_COLORS</em></p>
<blockquote>
<p>Takes a boolean argument. When true, <strong>systemd</strong> and related utilities
will use colors in their output, otherwise the output will be
monochrome. Additionally, the variable can take one of the following
special values: &#34;16&#34;, &#34;256&#34; to restrict the use of colors to the base 16
or 256 ANSI colors, respectively. This can be specified to override the
automatic decision based on <em>$TERM</em> and what the console is connected
to.</p>
</blockquote>
<p>
<em>$SYSTEMD_URLIFY</em></p>
<blockquote>
<p>The value must be a boolean. Controls whether clickable links should be
generated in the output for terminal emulators supporting this. This can
be specified to override the decision that <strong>systemd</strong> makes based on
<em>$TERM</em> and other conditions.</p>
</blockquote>
</div>
</div>
<div id="outline-container-headline-11" class="outline-2">
<h2 id="headline-11">
EXAMPLES
</h2>
<div id="outline-text-headline-11" class="outline-text-2">
<p><strong>Example 1. Create a user &#34;waldo&#34; in the administrator group &#34;wheel&#34;,
and assign 500 MiB disk space to them.</strong></p>
<blockquote>
<pre class="example">
homectl create waldo --real-name=&#34;Waldo McWaldo&#34; -G wheel --disk-size=500M
</pre>
</blockquote>
<p>
<strong>Example 2. Create a user &#34;wally&#34; on a USB stick, and assign a maximum
of 500 concurrent tasks to them.</strong></p>
<blockquote>
<pre class="example">
homectl create wally --real-name=&#34;Wally McWally&#34; --image-path=/dev/disk/by-id/usb-SanDisk_Ultra_Fit_476fff954b2b5c44-0:0 --tasks-max=500
</pre>
</blockquote>
<p>
*Example 3. Change nice level of user &#34;odlaw&#34; to +5 and make sure the
environment variable */$SOME/ is set to the string &#34;THING&#34; for them on
login.</p>
<blockquote>
<pre class="example">
homectl update odlaw --nice=5 --setenv=SOME=THING
</pre>
</blockquote>
<p>
<strong>Example 4. Set up authentication with a YubiKey security token using
PKCS#11/PIV:</strong></p>
<blockquote>
<pre class="example">
# Clear the Yubikey from any old keys (careful!)
ykman piv reset

# Generate a new private/public key pair on the device, store the public key in pubkey.pem.
ykman piv generate-key -a RSA2048 9d pubkey.pem

# Create a self-signed certificate from this public key, and store it on the device.
ykman piv generate-certificate --subject &#34;Knobelei&#34; 9d pubkey.pem

# We dont need the public key on disk anymore
rm pubkey.pem

# Allow the security token to unlock the account of user lafcadio.
homectl update lafcadio --pkcs11-token-uri=auto
</pre>
</blockquote>
<p>
<strong>Example 5. Set up authentication with a FIDO2 security token:</strong></p>
<blockquote>
<pre class="example">
# Allow a FIDO2 security token to unlock the account of user nihilbaxter.
homectl update nihilbaxter --fido2-device=auto
</pre>
</blockquote>
</div>
</div>
<div id="outline-container-headline-12" class="outline-2">
<h2 id="headline-12">
SEE ALSO
</h2>
<div id="outline-text-headline-12" class="outline-text-2">
<p>*systemd*(1), *systemd-homed.service*(8), *homed.conf*(5),
*userdbctl*(1), *useradd*(8), *cryptsetup*(8)</p>
</div>
</div>
<div id="outline-container-headline-13" class="outline-2">
<h2 id="headline-13">
NOTES
</h2>
<div id="outline-text-headline-13" class="outline-text-2">
<dl>
<dt>
1.
</dt>
<dd>JSON User Records

https://systemd.io/USER_RECORD</dd>
<dt>
2.
</dt>
<dd>Icon Naming Specification

https://standards.freedesktop.org/icon-naming-spec/icon-naming-spec-latest.html</dd>
<dt>
3.
</dt>
<dd>User Record Blob Directories

https://systemd.io/USER_RECORD_BLOB_DIRS</dd>
<dt>
4.
</dt>
<dd>User/Group Name Syntax

https://systemd.io/USER_NAMES</dd>
</dl>
</div>
</div>


        </main>
        <footer class="container footer">
            <p>Copyright 2024. All rights reserved.</p>

        </footer>

        
        

        
            <script src="/js/main.js"></script>
    </body>
</html>
